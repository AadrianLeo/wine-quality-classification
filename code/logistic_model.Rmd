---
title: "Logistic Regression Model (Wine Quality)"
author: ""
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
set.seed(123)
```

# Introduction

This document fits a logistic regression model to the cleaned red wine quality data and evaluates its performance.

# Packages

```{r packages}
# install.packages(c("here","caret","pROC","dplyr"))
library(here)
library(caret)
library(pROC)
library(dplyr)
```

# Load Data

```{r load-data}
# 1) Load cleaned data
data_path <- here("data", "winequality-red-clean.csv")
wine_model <- read.csv(data_path)

# Ensure target is factor with correct positive class
wine_model$quality_binary <- factor(wine_model$quality_binary,
                                    levels = c("Poor", "Premium"))

# Drop quality_factor if it exists
if ("quality_factor" %in% names(wine_model)) {
  wine_model$quality_factor <- NULL
}

# Sanity checks
stopifnot(all(sapply(dplyr::select(wine_model, -quality_binary), is.numeric)))
stopifnot(!anyNA(wine_model))

str(wine_model)
```

# Train / Validation / Test Split

```{r split-data}
# 2) Train/Validation/Test Split (60/20/20)
idx_train <- createDataPartition(wine_model$quality_binary, p = 0.60, list = FALSE)
train <- wine_model[idx_train, ]
temp  <- wine_model[-idx_train, ]

idx_valid <- createDataPartition(temp$quality_binary, p = 0.50, list = FALSE)
valid <- temp[idx_valid, ]
test  <- temp[-idx_valid, ]

sapply(list(train = train, valid = valid, test = test), nrow)
```

# Fit Logistic Regression Model

```{r fit-model}
# 3) Fit Logistic Regression (GLM binomial)
log_model <- glm(quality_binary ~ .,
                 data = train,
                 family = binomial)

summary(log_model)
```

